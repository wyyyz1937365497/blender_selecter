<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="blender_selecter.MainPage"
             Title="AI Image Editor &amp; 3D Generator">

       <Grid RowDefinitions="Auto,*,Auto"
             Padding="10"
             RowSpacing="10">
              <!-- é¡¶éƒ¨æ ‡é¢˜å’ŒæŒ‰é’® -->
              <VerticalStackLayout Grid.Row="0"
                                   Spacing="8">
                     <Label Text="ðŸŽ¨ AI Image to 3D"
                            FontSize="22"
                            HorizontalOptions="Center"
                            FontAttributes="Bold"
                            TextColor="#2C3E50"/>

                     <Button Text="ðŸ“ Select Image"
                             Clicked="OnSelectImageButtonClicked"
                             x:Name="SelectImageButton"
                             BackgroundColor="#007ACC"
                             TextColor="White"
                             HorizontalOptions="Center"
                             HeightRequest="40"
                             WidthRequest="180"
                             CornerRadius="8"/>

                     <!-- æ­¥éª¤æŒ‡å¼• -->
                     <Border Stroke="#E0E0E0"
                             StrokeThickness="1"
                             Padding="12,8"
                             Margin="20,5"
                             BackgroundColor="#F8F9FA"
                             StrokeShape="RoundRectangle 8"
                             HorizontalOptions="Center"
                             IsVisible="{Binding IsImageSelected}">
                            <VerticalStackLayout Spacing="4">
                                   <Label Text="ðŸ“‹ Workflow Guide"
                                          FontSize="12"
                                          FontAttributes="Bold"
                                          TextColor="#34495E"/>
                                   <Label Text="â‘  Enter prompt â†’ Click 'Edit Image' to AI-generate content"
                                          FontSize="11"
                                          TextColor="#7F8C8D"/>
                                   <Label Text="â‘¡ Draw boxes on edited image to select objects for 3D"
                                          FontSize="11"
                                          TextColor="#7F8C8D"/>
                                   <Label Text="â‘¢ Click '3D Rebuild' to generate 3D models"
                                          FontSize="11"
                                          TextColor="#7F8C8D"/>
                            </VerticalStackLayout>
                     </Border>
              </VerticalStackLayout>

              <!-- ä¸­é—´å›¾ç‰‡åŒºåŸŸ - å æ®æ‰€æœ‰å‰©ä½™ç©ºé—´ -->
              <Grid x:Name="ImageGrid"
                    Grid.Row="1"
                    IsVisible="{Binding IsImageSelected}"
                    HorizontalOptions="Fill"
                    VerticalOptions="Fill">
                     <Border Stroke="LightGray"
                             StrokeThickness="1"
                             HorizontalOptions="Fill"
                             VerticalOptions="Fill">
                            <Image x:Name="MainImage"
                                   Aspect="AspectFit"
                                   HorizontalOptions="Fill"
                                   VerticalOptions="Fill"/>
                     </Border>

                     <AbsoluteLayout x:Name="OverlayLayout"
                                     BackgroundColor="Transparent"
                                     HorizontalOptions="Fill"
                                     VerticalOptions="Fill"
                                     InputTransparent="False"/>
              </Grid>

              <!-- åº•éƒ¨æŒ‰é’®å’ŒçŠ¶æ€ -->
              <VerticalStackLayout Grid.Row="2"
                                   Spacing="10">

                     <!-- OmniGen2 Prompt è¾“å…¥åŒºåŸŸ - å±…ä¸­ä¸”æœ‰è¾¹è· -->
                     <Border Stroke="#9B59B6"
                             StrokeThickness="1"
                             Padding="12"
                             Margin="40,0"
                             BackgroundColor="#FAFAFA"
                             StrokeShape="RoundRectangle 10"
                             HorizontalOptions="Fill"
                             IsVisible="{Binding IsImageSelected}">
                            <VerticalStackLayout Spacing="6">
                                   <Label Text="âœ¨ Step 1: Describe what to generate"
                                          FontSize="13"
                                          FontAttributes="Bold"
                                          TextColor="#9B59B6"/>
                                   <Entry x:Name="PromptEntry"
                                          Placeholder="e.g., Add a beautiful sunset sky in the background..."
                                          PlaceholderColor="#AAAAAA"
                                          BackgroundColor="White"
                                          TextColor="#333333"
                                          HeightRequest="38"
                                          FontSize="13"
                                          TextChanged="OnPromptTextChanged"/>
                            </VerticalStackLayout>
                     </Border>

                     <!-- é€‰æ¡†æç¤º -->
                     <Label x:Name="SelectionHintLabel"
                            Text="ðŸ“¦ Step 2: Draw boxes to select objects for 3D reconstruction"
                            FontSize="12"
                            TextColor="#27AE60"
                            HorizontalOptions="Center"
                            IsVisible="False"/>

                     <!-- ä¸‰ä¸ªæŒ‰é’®æ°´å¹³æŽ’åˆ— -->
                     <HorizontalStackLayout Spacing="12"
                                            HorizontalOptions="Center">
                            <!-- æŒ‰é’®1: æ¸…é™¤é€‰æ¡† -->
                            <Button Text="ðŸ—‘ï¸ Clear"
                                    Clicked="OnClearSelectionsClicked"
                                    x:Name="ClearSelectionsButton"
                                    BackgroundColor="#E74C3C"
                                    TextColor="White"
                                    IsEnabled="False"
                                    HeightRequest="42"
                                    WidthRequest="100"
                                    CornerRadius="8"
                                    FontSize="13"/>

                            <!-- æŒ‰é’®2: OmniGen2 å›¾åƒç¼–è¾‘ (åªéœ€å›¾ç‰‡+prompt) -->
                            <Button Text="ðŸŽ¨ Edit Image"
                                    Clicked="OnOmniGen2EditClicked"
                                    x:Name="OmniGen2Button"
                                    BackgroundColor="#9B59B6"
                                    TextColor="White"
                                    IsEnabled="False"
                                    HeightRequest="42"
                                    WidthRequest="130"
                                    CornerRadius="8"
                                    FontSize="13"/>

                            <!-- æŒ‰é’®3: 3D é‡å»º (éœ€è¦é€‰æ¡†) -->
                            <Button Text="ðŸ§Š 3D Rebuild"
                                    Clicked="OnMidi3DRebuildClicked"
                                    x:Name="Midi3DButton"
                                    BackgroundColor="#007ACC"
                                    TextColor="White"
                                    IsEnabled="False"
                                    HeightRequest="42"
                                    WidthRequest="130"
                                    CornerRadius="8"
                                    FontSize="13"/>
                     </HorizontalStackLayout>

                     <ActivityIndicator x:Name="LoadingIndicator"
                                        IsRunning="False"
                                        HeightRequest="30"/>

                     <Label x:Name="StatusMessage"
                            HorizontalOptions="Center"
                            TextColor="Green"
                            FontSize="12"/>

                     <Label x:Name="TaskIdLabel"
                            HorizontalOptions="Center"
                            FontAttributes="Bold"
                            FontSize="12"
                            IsVisible="False"/>
              </VerticalStackLayout>
       </Grid>

</ContentPage>