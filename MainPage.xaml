<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="blender_selecter.MainPage"
             Title="AI Image Editor &amp; 3D Generator">

       <Grid ColumnDefinitions="*,300"
             Padding="10"
             ColumnSpacing="10"
             VerticalOptions="FillAndExpand">
              <!-- å·¦ä¾§å›¾ç‰‡åŒºåŸŸ - å æ®å¤§éƒ¨åˆ†ç©ºé—´ -->
              <Grid x:Name="ImageGrid"
                    Grid.Column="0"
                    IsVisible="{Binding IsImageSelected}"
                    HorizontalOptions="Fill"
                    VerticalOptions="FillAndExpand">
                     <Border Stroke="LightGray"
                             StrokeThickness="1"
                             HorizontalOptions="Fill"
                             VerticalOptions="FillAndExpand">
                            <Image x:Name="MainImage"
                                   Aspect="AspectFit"
                                   HorizontalOptions="Fill"
                                   VerticalOptions="FillAndExpand"/>
                     </Border>

                     <AbsoluteLayout x:Name="OverlayLayout"
                                     BackgroundColor="Transparent"
                                     HorizontalOptions="Fill"
                                     VerticalOptions="FillAndExpand"
                                     InputTransparent="False"/>
              </Grid>

              <!-- å³ä¾§æŽ§ä»¶åŒºåŸŸ -->
              <ScrollView Grid.Column="1"
                          VerticalOptions="FillAndExpand">
                     <VerticalStackLayout Spacing="10">
                            <!-- é¡¶éƒ¨æ ‡é¢˜å’ŒæŒ‰é’® -->
                            <VerticalStackLayout Spacing="8">
                                   <Label Text="ðŸŽ¨ AI Image to 3D"
                                          FontSize="22"
                                          HorizontalOptions="Center"
                                          FontAttributes="Bold"
                                          TextColor="#2C3E50"/>

                                   <Button Text="ðŸ“ Select Image"
                                           Clicked="OnSelectImageButtonClicked"
                                           x:Name="SelectImageButton"
                                           BackgroundColor="#007ACC"
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           HeightRequest="40"
                                           WidthRequest="180"
                                           CornerRadius="8"/>

                                   <!-- æ­¥éª¤æŒ‡å¼• -->
                                   <Border Stroke="#E0E0E0"
                                           StrokeThickness="1"
                                           Padding="12,8"
                                           Margin="0,5"
                                           BackgroundColor="#F8F9FA"
                                           StrokeShape="RoundRectangle 8"
                                           HorizontalOptions="Fill"
                                           IsVisible="{Binding IsImageSelected}">
                                          <VerticalStackLayout Spacing="4">
                                                 <Label Text="ðŸ“‹ Workflow Guide"
                                                        FontSize="12"
                                                        FontAttributes="Bold"
                                                        TextColor="#34495E"/>
                                                 <Label Text="â‘  Enter prompt â†’ Click 'Edit Image' to AI-generate content"
                                                        FontSize="11"
                                                        TextColor="#7F8C8D"/>
                                                 <Label Text="â‘¡ Draw boxes on edited image to select objects for 3D"
                                                        FontSize="11"
                                                        TextColor="#7F8C8D"/>
                                                 <Label Text="â‘¢ Click '3D Rebuild' to generate 3D models"
                                                        FontSize="11"
                                                        TextColor="#7F8C8D"/>
                                          </VerticalStackLayout>
                                   </Border>
                            </VerticalStackLayout>

                            <!-- OmniGen2 Prompt è¾“å…¥åŒºåŸŸ -->
                            <Border Stroke="#9B59B6"
                                    StrokeThickness="1"
                                    Padding="12"
                                    Margin="0"
                                    BackgroundColor="#FAFAFA"
                                    StrokeShape="RoundRectangle 10"
                                    HorizontalOptions="Fill"
                                    IsVisible="{Binding IsImageSelected}">
                                   <VerticalStackLayout Spacing="6">
                                          <Label Text="âœ¨ Step 1: Describe what to generate"
                                                 FontSize="13"
                                                 FontAttributes="Bold"
                                                 TextColor="#9B59B6"/>
                                          <Editor x:Name="PromptEntry"
                                                  Placeholder="e.g., Add a beautiful sunset sky in the background..."
                                                  PlaceholderColor="#AAAAAA"
                                                  BackgroundColor="White"
                                                  TextColor="#333333"
                                                  HeightRequest="100"
                                                  FontSize="13"
                                                  TextChanged="OnPromptTextChanged"
                                                  AutoSize="TextChanges"/>
                                   </VerticalStackLayout>
                            </Border>

                            <!-- é€‰æ¡†æç¤º -->
                            <Label x:Name="SelectionHintLabel"
                                   Text="ðŸ“¦ Step 2: Draw boxes to select objects for 3D reconstruction"
                                   FontSize="12"
                                   TextColor="#27AE60"
                                   HorizontalOptions="Center"
                                   IsVisible="False"/>

                            <!-- ä¸‰ä¸ªæŒ‰é’®åž‚ç›´æŽ’åˆ— -->
                            <VerticalStackLayout Spacing="12"
                                                 HorizontalOptions="Center"
                                                 WidthRequest="200">
                                   <!-- æŒ‰é’®1: æ¸…é™¤é€‰æ¡† -->
                                   <Button Text="ðŸ—‘ï¸ Clear"
                                           Clicked="OnClearSelectionsClicked"
                                           x:Name="ClearSelectionsButton"
                                           BackgroundColor="#E74C3C"
                                           TextColor="White"
                                           IsEnabled="False"
                                           HeightRequest="42"
                                           CornerRadius="8"
                                           FontSize="13"/>

                                   <!-- æŒ‰é’®2: OmniGen2 å›¾åƒç¼–è¾‘ (åªéœ€å›¾ç‰‡+prompt) -->
                                   <Button Text="ðŸŽ¨ Edit with ComfyUI"
                                           Clicked="OnOmniGen2EditClicked"
                                           x:Name="OmniGen2Button"
                                           BackgroundColor="#9B59B6"
                                           TextColor="White"
                                           IsEnabled="False"
                                           HeightRequest="42"
                                           CornerRadius="8"
                                           FontSize="13"/>

                                   <!-- æŒ‰é’®3: 3D é‡å»º (éœ€è¦é€‰æ¡†) -->
                                   <Button Text="ðŸ§Š 3D Rebuild"
                                           Clicked="OnMidi3DRebuildClicked"
                                           x:Name="Midi3DButton"
                                           BackgroundColor="#007ACC"
                                           TextColor="White"
                                           IsEnabled="False"
                                           HeightRequest="42"
                                           CornerRadius="8"
                                           FontSize="13"/>
                            </VerticalStackLayout>

                            <ActivityIndicator x:Name="LoadingIndicator"
                                               IsRunning="False"
                                               HeightRequest="30"
                                               HorizontalOptions="Center"/>

                            <!-- æ·»åŠ ComfyUIè¿›åº¦æ¡ -->
                            <ProgressBar x:Name="ComfyUIProgressBar"
                                         IsVisible="False"
                                         HeightRequest="10"
                                         HorizontalOptions="Fill"/>

                            <!-- æ·»åŠ MIDI-3Dè¿›åº¦æ¡ -->
                            <ProgressBar x:Name="Midi3DProgressBar"
                                         IsVisible="False"
                                         HeightRequest="10"
                                         HorizontalOptions="Fill"/>

                            <Label x:Name="StatusMessage"
                                   HorizontalOptions="Center"
                                   TextColor="Green"
                                   FontSize="12"/>

                            <Label x:Name="TaskIdLabel"
                                   HorizontalOptions="Center"
                                   FontAttributes="Bold"
                                   FontSize="12"
                                   IsVisible="False"/>
                     </VerticalStackLayout>
              </ScrollView>
       </Grid>

</ContentPage>