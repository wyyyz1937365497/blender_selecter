<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="blender_selecter.MainPage"
             Title="AI Image Editor &amp; 3D Generator">

       <Grid ColumnDefinitions="*,300"
             Padding="10"
             ColumnSpacing="10"
             VerticalOptions="FillAndExpand">
              <!-- å·¦ä¾§å›¾ç‰‡åŒºåŸŸ - å æ®å¤§éƒ¨åˆ†ç©ºé—´ -->
              <Grid x:Name="ImageGrid"
                    Grid.Column="0"
                    IsVisible="{Binding IsImageSelected}"
                    HorizontalOptions="Fill"
                    VerticalOptions="FillAndExpand">
                     <Border Stroke="LightGray"
                             StrokeThickness="1"
                             HorizontalOptions="Fill"
                             VerticalOptions="FillAndExpand">
                            <Image x:Name="MainImage"
                                   Aspect="AspectFit"
                                   HorizontalOptions="Fill"
                                   VerticalOptions="FillAndExpand"/>
                     </Border>

                     <AbsoluteLayout x:Name="OverlayLayout"
                                     BackgroundColor="Transparent"
                                     HorizontalOptions="Fill"
                                     VerticalOptions="FillAndExpand"
                                     InputTransparent="False"/>
              </Grid>

              <!-- å³ä¾§æŽ§ä»¶åŒºåŸŸ -->
              <ScrollView Grid.Column="1"
                          VerticalOptions="FillAndExpand">
                     <VerticalStackLayout Spacing="10">
                            <!-- é¡¶éƒ¨æ ‡é¢˜å’ŒæŒ‰é’® -->
                            <VerticalStackLayout Spacing="8">
                                   <Label Text="ðŸŽ¨ AI Image to 3D"
                                          FontSize="22"
                                          HorizontalOptions="Center"
                                          FontAttributes="Bold"
                                          TextColor="#2C3E50"/>

                                   <Button Text="ðŸ“ Select Image"
                                           Clicked="OnSelectImageButtonClicked"
                                           x:Name="SelectImageButton"
                                           BackgroundColor="#007ACC"
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           HeightRequest="40"
                                           WidthRequest="250"
                                           CornerRadius="8"/>

                                   <!-- æ­¥éª¤æŒ‡å¼• -->
                                   <Border Stroke="#E0E0E0"
                                           StrokeThickness="1"
                                           Padding="12,8"
                                           Margin="0,5"
                                           BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#2D2D2D}"
                                           StrokeShape="RoundRectangle 8"
                                           HorizontalOptions="Fill"
                                           IsVisible="{Binding IsImageSelected}">
                                          <VerticalStackLayout Spacing="4">
                                                 <Label Text="ðŸ“‹ Workflow Guide"
                                                        FontSize="12"
                                                        FontAttributes="Bold"
                                                        TextColor="{AppThemeBinding Light=#34495E, Dark=#E0E0E0}"/>
                                                 <Label Text="â‘  Enter prompt â†’ Click 'Edit Image' to AI-generate content"
                                                        FontSize="11"
                                                        TextColor="{AppThemeBinding Light=#7F8C8D, Dark=#B0B0B0}"/>
                                                 <Label Text="â‘¡ Draw boxes on edited image to select objects for 3D"
                                                        FontSize="11"
                                                        TextColor="{AppThemeBinding Light=#7F8C8D, Dark=#B0B0B0}"/>
                                                 <Label Text="â‘¢ Click '3D Rebuild' to generate 3D models"
                                                        FontSize="11"
                                                        TextColor="{AppThemeBinding Light=#7F8C8D, Dark=#B0B0B0}"/>
                                          </VerticalStackLayout>
                                   </Border>
                            </VerticalStackLayout>

                            <!-- OmniGen2 Prompt è¾“å…¥åŒºåŸŸ -->
                            <Border Stroke="#9B59B6"
                                    StrokeThickness="1"
                                    Padding="12"
                                    Margin="0"
                                    BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#2D2D2D}"
                                    StrokeShape="RoundRectangle 10"
                                    HorizontalOptions="Fill"
                                    IsVisible="{Binding IsImageSelected}">
                                   <VerticalStackLayout Spacing="6">
                                          <Label Text="âœ¨ Step 1: Describe what to generate"
                                                 FontSize="13"
                                                 FontAttributes="Bold"
                                                 TextColor="#9B59B6"/>
                                          <Editor x:Name="PromptEntry"
                                                  Placeholder="e.g., Add a beautiful sunset sky in the background..."
                                                  PlaceholderColor="{AppThemeBinding Light=#AAAAAA, Dark=#CCCCCC}"
                                                  BackgroundColor="{AppThemeBinding Light=White, Dark=#1D1D1D}"
                                                  TextColor="{AppThemeBinding Light=#333333, Dark=#E0E0E0}"
                                                  HeightRequest="100"
                                                  FontSize="13"
                                                  TextChanged="OnPromptTextChanged"
                                                  AutoSize="TextChanges"
                                                  HorizontalOptions="Fill"
                                                  WidthRequest="250"/>
                                   </VerticalStackLayout>
                            </Border>

                            <!-- æ¨¡åž‹é€‰æ‹©ä¸‹æ‹‰æ¡† -->
                            <Border x:Name="ModelSelectionBorder"
                                    Stroke="#3498DB"
                                    StrokeThickness="1"
                                    Padding="12"
                                    Margin="0"
                                    BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#2D2D2D}"
                                    StrokeShape="RoundRectangle 10"
                                    HorizontalOptions="Fill"
                                    IsVisible="{Binding IsImageSelected}">
                                   <VerticalStackLayout Spacing="6">
                                          <Label Text="ðŸ¤– Select AI Model"
                                                 FontSize="13"
                                                 FontAttributes="Bold"
                                                 TextColor="#3498DB"/>
                                          <Picker x:Name="ModelPicker"
                                                  Title="Choose Model"
                                                  SelectedIndexChanged="OnModelPickerSelectedIndexChanged"
                                                  HorizontalOptions="Fill"
                                                  WidthRequest="250"
                                                  BackgroundColor="{AppThemeBinding Light=White, Dark=#2D2D2D}"
                                                  TextColor="{AppThemeBinding Light=Black, Dark=White}">
                                                 <Picker.ItemsSource>
                                                        <x:Array Type="{x:Type x:String}">
                                                               <x:String>OmniGen2</x:String>
                                                               <x:String>Qwen-Image-Edit</x:String>
                                                        </x:Array>
                                                 </Picker.ItemsSource>
                                          </Picker>
                                   </VerticalStackLayout>
                            </Border>

                            <!-- è´Ÿé¢æç¤ºè¯åŒºåŸŸ -->
                            <Border x:Name="NegativePromptBorder"
                                    Stroke="#FFA500"
                                    StrokeThickness="1"
                                    Padding="12"
                                    Margin="0"
                                    BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#2D2D2D}"
                                    StrokeShape="RoundRectangle 10"
                                    HorizontalOptions="Fill"
                                    IsVisible="{Binding IsImageSelected}">
                                   <VerticalStackLayout Spacing="6">
                                          <StackLayout Orientation="Horizontal" HorizontalOptions="Fill">
                                                <Label Text="ðŸ”» Negative Prompt (click to toggle)"
                                                       FontSize="13"
                                                       FontAttributes="Bold"
                                                       TextColor="#FFA500"
                                                       HorizontalOptions="StartAndExpand"/>
                                                <Switch x:Name="NegativePromptToggle"
                                                        IsToggled="False"
                                                        Toggled="OnNegativePromptToggled"
                                                        HorizontalOptions="End"/>
                                          </StackLayout>
                                          <Editor x:Name="NegativePromptEntry"
                                                  Placeholder="Enter negative prompt here..."
                                                  PlaceholderColor="{AppThemeBinding Light=#AAAAAA, Dark=#CCCCCC}"
                                                  BackgroundColor="{AppThemeBinding Light=White, Dark=#1D1D1D}"
                                                  TextColor="{AppThemeBinding Light=#333333, Dark=#E0E0E0}"
                                                  HeightRequest="80"
                                                  FontSize="13"
                                                  IsVisible="False"
                                                  HorizontalOptions="Fill"
                                                  WidthRequest="250"/>
                                   </VerticalStackLayout>
                            </Border>

                            <!-- é€‰æ¡†æç¤º -->
                            <Label x:Name="SelectionHintLabel"
                                   Text="ðŸ“¦ Step 2: Draw boxes to select objects for 3D reconstruction"
                                   FontSize="12"
                                   TextColor="#27AE60"
                                   HorizontalOptions="Center"
                                   IsVisible="False"/>

                            <!-- ä¸‰ä¸ªæŒ‰é’®åž‚ç›´æŽ’åˆ— -->
                            <VerticalStackLayout Spacing="12"
                                                 HorizontalOptions="Center"
                                                 WidthRequest="250">
                                   <!-- æŒ‰é’®1: æ¸…é™¤é€‰æ¡† -->
                                   <Button Text="ðŸ—‘ï¸ Clear"
                                           Clicked="OnClearSelectionsClicked"
                                           x:Name="ClearSelectionsButton"
                                           BackgroundColor="#E74C3C"
                                           TextColor="White"
                                           IsEnabled="False"
                                           HeightRequest="42"
                                           CornerRadius="8"
                                           FontSize="13"
                                           HorizontalOptions="Fill"
                                           WidthRequest="250"/>

                                   <!-- æŒ‰é’®2: OmniGen2 å›¾åƒç¼–è¾‘ (åªéœ€å›¾ç‰‡+prompt) -->
                                   <Button Text="ðŸŽ¨ Edit with ComfyUI"
                                           Clicked="OnOmniGen2EditClicked"
                                           x:Name="OmniGen2Button"
                                           BackgroundColor="#9B59B6"
                                           TextColor="White"
                                           IsEnabled="False"
                                           HeightRequest="42"
                                           CornerRadius="8"
                                           FontSize="13"
                                           HorizontalOptions="Fill"
                                           WidthRequest="250"/>

                                   <!-- æŒ‰é’®3: 3D é‡å»º (éœ€è¦é€‰æ¡†) -->
                                   <Button Text="ðŸ§Š 3D Rebuild"
                                           Clicked="OnMidi3DRebuildClicked"
                                           x:Name="Midi3DButton"
                                           BackgroundColor="#007ACC"
                                           TextColor="White"
                                           IsEnabled="False"
                                           HeightRequest="42"
                                           CornerRadius="8"
                                           FontSize="13"
                                           HorizontalOptions="Fill"
                                           WidthRequest="250"/>
                            </VerticalStackLayout>

                            <ActivityIndicator x:Name="LoadingIndicator"
                                               IsRunning="False"
                                               HeightRequest="30"
                                               HorizontalOptions="Center"/>

                            <!-- æ·»åŠ ComfyUIè¿›åº¦æ¡ -->
                            <ProgressBar x:Name="ComfyUIProgressBar"
                                         IsVisible="False"
                                         HeightRequest="10"
                                         HorizontalOptions="Fill"/>

                            <!-- æ·»åŠ MIDI-3DçŽ¯å½¢è¿›åº¦æ¡ -->
                            <ActivityIndicator x:Name="Midi3DSpinner"
                                               IsRunning="False"
                                               IsVisible="False"
                                               HeightRequest="40"
                                               WidthRequest="40"
                                               Color="#007ACC"
                                               HorizontalOptions="Center"/>
                                         
                            <!-- æ·»åŠ MIDI-3Dè¿›åº¦æ¡ -->
                            <ProgressBar x:Name="Midi3DProgressBar"
                                         IsVisible="False"
                                         HeightRequest="10"
                                         HorizontalOptions="Fill"/>

                            <Label x:Name="StatusMessage"
                                   HorizontalOptions="Center"
                                   TextColor="Green"
                                   FontSize="12"/>

                            <Label x:Name="TaskIdLabel"
                                   HorizontalOptions="Center"
                                   FontAttributes="Bold"
                                   FontSize="12"
                                   IsVisible="False"/>
                     </VerticalStackLayout>
              </ScrollView>
       </Grid>

</ContentPage>